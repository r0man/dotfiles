#!/usr/bin/env ruby

def current
  c = IO::popen("pacmd \"list-sinks\" | grep volume | head -1").readlines.first
  return c.split(" ").last.sub("%", "").strip.to_i
end

def index
  c = IO::popen("pacmd \"list-sinks\" | grep index | head -1").readlines.first
  return c.split(" ").last.strip.to_i
end

def max
  c = IO::popen("pacmd \"list-sinks\" | grep \"volume steps\" | head -1").readlines.first
  return c.split(" ").last.strip.to_i - 1
end

def set(v)
  IO::popen("pacmd \"set-sink-volume #{index} #{v}\"").readlines
end

def muted?
  c = IO::popen("pacmd \"list-sinks\" | grep muted | head -1").readlines.first
  return c.split(" ").last.strip == "yes"
end

def toggle
  IO::popen("pacmd \"set-sink-mute #{index} #{muted? ? 0 : 1}\"").readlines
end

interval = 5

case ARGV.first
when "down" then set([current - interval, 0].max * (max / 100.0).round)
when "up" then set([current + interval, 100].min * (max / 100.0).round)
when "toggle" then toggle
else puts current
end
